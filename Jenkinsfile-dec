pipeline {
    agent { label 'slave-1' }
    //agent any
    tools {maven 'mvn398'}

    stages {
        stage('build') {
            steps {
                echo "this is build stage"
                sh 'mvn clean package -DskipTests'
            }
        }

        stage('test') {
            steps {
                echo "this is test stage"
                sh 'mvn test'
            }
        }

        stage('Dockerized the app') {
            steps {
                echo "this is dockerize stage"
                sh 'docker build -t java-test -f Dockerfile .'
            }
        }

        stage('login and push') {
           steps {
               echo "this is login and push stage"
               withCredentials([usernamePassword(credentialsId: 'docker-hup', passwordVariable: 'pass', usernameVariable: 'user')]) {
                sh "echo ${pass} | docker login -u ${user} --password-stdin"
                sh "docker tag java-test ${user}/java-test"
                sh "docker push ${user}/java-test"
        }
    }
}

        
        }
    }

    post {
        success {
            slackSend (
                channel: '#jenkins-ci',
                message: "Build Success - ${env.JOB_NAME} ${env.BUILD_NUMBER} (<${env.BUILD_URL}|Open>)",
                teamDomain: 'jenkinstest-xxj7763',
                tokenCredentialId: 'slack-notificate'
            )
        }
        failure {
            slackSend (
                channel: '#jenkins-ci',
                message: "Build Failed - ${env.JOB_NAME} ${env.BUILD_NUMBER} (<${env.BUILD_URL}|Open>)",
                teamDomain: 'jenkinstest-xxj7763',
                tokenCredentialId: 'slack-notificate'
            )
        }
    }




// this to configure merge with main in pipeline

// https://github.com/your-username/your-repo.git
// ```

// **Credentials:** Select your GitHub credentials

// **Click "Advanced" under Repository**, then add:

// **Refspec:**
// ```
// +refs/pull/${ghprbPullId}/*:refs/remotes/origin/pr/${ghprbPullId}/*
// ```

// **Branches to build - Branch Specifier:**
// ```
// origin/pr/${ghprbPullId}/merge

// GitHub Pull Request Builder Section:
// Make sure these are set:

// ✅ Use github hooks for build triggering - Checked
// ✅ Build every pull request automatically - Checked

// Whitelist Target Branches: (if you only want to test PRs to main)

// Click "Add Branch"
// Enter: main